# SebeJJ 核心系统测试用例

## 文档信息

| 项目 | 内容 |
|------|------|
| 所属系统 | 核心系统 (Core Systems) |
| 覆盖模块 | GameManager, EventSystem, SaveSystem, ObjectPool |
| 用例总数 | 32 |

---

## 1. GameManager 测试用例

### TC-GM-001: 游戏状态切换 - 正常流程
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 功能测试 |
| 前置条件 | GameManager已初始化 |

**测试步骤:**
1. 启动游戏，验证初始状态为 `MainMenu`
2. 调用 `ChangeState(GameState.Playing)`
3. 验证当前状态为 `Playing`
4. 调用 `ChangeState(GameState.Paused)`
5. 验证当前状态为 `Paused`

**预期结果:**
- 状态切换成功
- `CurrentState` 属性正确更新
- 无异常抛出

---

### TC-GM-002: 游戏状态切换 - 无效状态
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 异常测试 |

**测试步骤:**
1. 尝试切换到未定义的游戏状态
2. 观察系统行为

**预期结果:**
- 系统不崩溃
- 记录警告日志
- 保持当前状态不变

---

### TC-GM-003: 暂停游戏功能
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 游戏处于 `Playing` 状态
2. 调用 `PauseGame()`
3. 验证时间缩放为0
4. 验证状态变为 `Paused`
5. 验证暂停事件已触发

**预期结果:**
- `Time.timeScale` 变为 0
- 游戏状态变为 `Paused`
- 暂停UI显示

---

### TC-GM-004: 恢复游戏功能
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 游戏处于 `Paused` 状态
2. 调用 `ResumeGame()`
3. 验证时间缩放恢复为1
4. 验证状态变为 `Playing`

**预期结果:**
- `Time.timeScale` 恢复为 1
- 游戏状态变为 `Playing`
- 暂停UI隐藏

---

### TC-GM-005: 场景加载 - 正常加载
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 调用 `LoadScene("MainScene")`
2. 等待场景加载完成
3. 验证当前场景名正确

**预期结果:**
- 场景加载成功
- 无内存泄漏
- 加载事件已触发

---

### TC-GM-006: 关卡加载 - 带深度参数
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 调用 `LoadLevel(100)` (深度100米)
2. 验证关卡生成参数正确
3. 验证深度设置已应用

**预期结果:**
- 关卡按深度参数生成
- 环境难度与深度匹配

---

### TC-GM-007: 单例模式 - 唯一实例
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 单元测试 |

**测试步骤:**
1. 多次访问 `GameManager.Instance`
2. 验证返回的是同一实例

**预期结果:**
- 所有访问返回相同实例
- 不会创建重复实例

---

### TC-GM-008: 游戏退出处理
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 游戏进行中
2. 触发退出游戏
3. 验证自动存档已执行
4. 验证资源已释放

**预期结果:**
- 自动存档成功
- 无资源泄漏
- 正常退出

---

## 2. EventSystem 测试用例

### TC-EV-001: 事件订阅 - 基础订阅
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 单元测试 |

**测试步骤:**
1. 订阅 `OnGameStart` 事件
2. 触发游戏开始
3. 验证回调函数被调用

**预期结果:**
- 回调函数执行一次
- 参数传递正确

---

### TC-EV-002: 事件订阅 - 多订阅者
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 单元测试 |

**测试步骤:**
1. 多个对象订阅同一事件
2. 触发事件
3. 验证所有订阅者都被通知

**预期结果:**
- 所有订阅者的回调都被调用
- 调用顺序与订阅顺序一致

---

### TC-EV-003: 事件取消订阅
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 单元测试 |

**测试步骤:**
1. 订阅事件
2. 取消订阅
3. 触发事件
4. 验证回调不再被调用

**预期结果:**
- 取消订阅后回调不再执行
- 其他订阅者不受影响

---

### TC-EV-004: 事件参数传递 - 生命值变化
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 订阅 `OnHealthChanged` 事件
2. 修改玩家生命值
3. 验证事件参数包含正确数值

**预期结果:**
- 事件参数 `float` 值正确
- 参数反映当前生命值百分比

---

### TC-EV-005: 事件参数传递 - 资源收集
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 订阅 `OnResourceCollected` 事件
2. 收集资源
3. 验证资源类型和数量参数正确

**预期结果:**
- `ResourceType` 参数正确
- `int` 数量参数正确

---

### TC-EV-006: 空事件安全调用
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 异常测试 |

**测试步骤:**
1. 确保事件无订阅者
2. 触发事件
3. 验证系统不崩溃

**预期结果:**
- 无异常抛出
- 系统正常运行

---

### TC-EV-007: 事件解耦验证
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 架构测试 |

**测试步骤:**
1. 检查事件发布者和订阅者
2. 验证无直接引用关系

**预期结果:**
- 发布者不依赖订阅者
- 通过事件系统间接通信

---

## 3. SaveSystem 测试用例

### TC-SV-001: 存档功能 - 正常存档
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 创建测试 `PlayerData`
2. 调用 `SaveGame(data)`
3. 验证存档文件已创建
4. 验证文件内容正确

**预期结果:**
- 存档文件生成成功
- JSON格式正确
- 数据完整无误

---

### TC-SV-002: 读档功能 - 正常读档
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 创建并保存测试数据
2. 调用 `LoadGame()`
3. 验证返回数据与保存一致

**预期结果:**
- 数据正确反序列化
- 所有字段值正确恢复

---

### TC-SV-003: 读档 - 无存档文件
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 异常测试 |

**测试步骤:**
1. 确保无存档文件
2. 调用 `LoadGame()`
3. 观察系统行为

**预期结果:**
- 返回 null 或默认数据
- 无异常崩溃
- 记录信息日志

---

### TC-SV-004: 存档覆盖
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 创建初始存档
2. 修改数据后再次存档
3. 验证旧存档被覆盖
4. 验证新数据正确保存

**预期结果:**
- 旧存档被新存档替换
- 数据更新正确

---

### TC-SV-005: 删除存档
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 创建存档文件
2. 调用 `DeleteSave()`
3. 验证文件已删除

**预期结果:**
- 存档文件被删除
- 再次读档返回空/默认

---

### TC-SV-006: 自动存档
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 配置自动存档间隔
2. 游戏运行超过间隔时间
3. 验证自动存档触发

**预期结果:**
- 按设定间隔自动存档
- 存档数据正确

---

### TC-SV-007: 存档数据完整性 - 复杂数据
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 数据测试 |

**测试步骤:**
1. 创建包含所有数据类型的存档
2. 保存并重新加载
3. 验证所有数据完整

**预期结果:**
- 基础类型完整
- 集合类型完整
- 嵌套对象完整

---

### TC-SV-008: 存档兼容性 - 版本升级
| 属性 | 内容 |
|------|------|
| 优先级 | P2 |
| 测试类型 | 兼容性测试 |

**测试步骤:**
1. 使用旧版本格式存档
2. 使用新版本读取
3. 验证数据迁移正确

**预期结果:**
- 旧存档可正常读取
- 缺失字段使用默认值

---

## 4. ObjectPool 测试用例

### TC-OP-001: 对象获取 - 池中有对象
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 单元测试 |

**测试步骤:**
1. 预热对象池
2. 调用 `Get()` 获取对象
3. 验证返回有效对象

**预期结果:**
- 返回非空对象
- 对象已激活

---

### TC-OP-002: 对象获取 - 池空时扩展
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 单元测试 |

**测试步骤:**
1. 清空对象池
2. 调用 `Get()` 获取对象
3. 验证池自动扩展

**预期结果:**
- 池容量增加
- 返回新创建的对象

---

### TC-OP-003: 对象回收
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 单元测试 |

**测试步骤:**
1. 从池中获取对象
2. 使用对象
3. 调用 `Return(obj)` 回收
4. 验证对象回到池中

**预期结果:**
- 对象被禁用
- 池计数增加
- 对象状态重置

---

### TC-OP-004: 对象回收 - 重复回收
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 异常测试 |

**测试步骤:**
1. 获取并回收对象
2. 再次回收同一对象
3. 观察系统行为

**预期结果:**
- 系统不崩溃
- 记录警告日志
- 池状态保持一致

---

### TC-OP-005: 预热功能
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 调用 `Prewarm(count)`
2. 验证池中对象数量

**预期结果:**
- 池中有指定数量对象
- 所有对象处于禁用状态

---

### TC-OP-006: 内存管理 - 大量对象
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 性能测试 |

**测试步骤:**
1. 循环获取和回收1000个对象
2. 监控内存使用
3. 验证无内存泄漏

**预期结果:**
- 内存使用稳定
- 无持续增长

---

### TC-OP-007: 多类型对象池
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 功能测试 |

**测试步骤:**
1. 创建不同类型对象池
2. 分别获取/回收各类型
3. 验证类型隔离正确

**预期结果:**
- 各类型池独立工作
- 无类型混淆

---

## 5. 集成测试用例

### TC-INT-001: 游戏流程 - 启动到游玩
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 集成测试 |

**测试步骤:**
1. 启动游戏
2. 验证 GameManager 初始化
3. 加载场景
4. 验证所有系统就绪

**预期结果:**
- 所有系统正常初始化
- 无报错
- 可开始游戏

---

### TC-INT-002: 暂停-存档-恢复流程
| 属性 | 内容 |
|------|------|
| 优先级 | P0 |
| 测试类型 | 集成测试 |

**测试步骤:**
1. 游戏进行中
2. 暂停游戏
3. 手动存档
4. 恢复游戏
5. 验证游戏状态正确

**预期结果:**
- 暂停时存档成功
- 恢复后游戏继续
- 数据无丢失

---

### TC-INT-003: 事件驱动存档
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 集成测试 |

**测试步骤:**
1. 订阅关卡完成事件
2. 完成关卡
3. 验证事件触发存档

**预期结果:**
- 事件正确触发
- 自动存档执行

---

### TC-INT-004: 对象池与场景切换
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 集成测试 |

**测试步骤:**
1. 场景A中使用对象池
2. 切换场景B
3. 验证对象池正确重置

**预期结果:**
- 场景切换无内存泄漏
- 对象池状态正确

---

## 6. 性能测试用例

### TC-PERF-001: 存档加载性能
| 属性 | 内容 |
|------|------|
| 优先级 | P1 |
| 测试类型 | 性能测试 |

**测试步骤:**
1. 创建大型存档文件
2. 测量加载时间
3. 验证 < 1秒

**预期结果:**
- 加载时间符合要求

---

### TC-PERF-002: 事件系统性能
| 属性 | 内容 |
|------|------|
| 优先级 | P2 |
| 测试类型 | 性能测试 |

**测试步骤:**
1. 注册100个事件处理器
2. 高频触发事件
3. 监控性能影响

**预期结果:**
- 帧率无明显下降

---

## 附录: 测试数据

### 测试存档数据结构
```json
{
  "playerName": "TestPlayer",
  "currentDepth": 150.5,
  "health": 85.0,
  "energy": 60.0,
  "oxygen": 90.0,
  "position": {"x": 10.5, "y": -150.5},
  "inventory": [
    {"type": "CopperOre", "count": 5},
    {"type": "ScrapMetal", "count": 10}
  ],
  "upgrades": ["SpeedBoost", "OxygenTank"]
}
```

---

**文档版本:** 1.0  
**创建日期:** 2026-02-26  
**作者:** 测试工程师 Agent
