# 50米深度测试区 - 战斗场景测试文档

## 场景概述

**场景名称**: 50米深度测试区  
**场景ID**: CombatTest_50m  
**版本**: 1.0.0  
**测试目的**: 验证敌人-机甲交互系统、战斗循环、掉落系统的完整性

---

## 场景配置

### 环境参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 深度 | 50米 | 中等深度，基础氧气消耗 |
| 氧气消耗倍率 | 1.2x | 比浅水区略高 |
| 可见范围 | 25米 | 中等能见度 |
| 光照等级 | 0.6 | 昏暗环境 |
| 场景边界 | 30x30米 | 方形封闭区域 |

### 玩家初始状态

| 属性 | 初始值 | 最大值 |
|------|--------|--------|
| 生命值 | 100 | 100 |
| 护盾 | 50 | 50 |
| 装甲 | 30 | 30 |
| 氧气 | 100 | 100 |
| 能源 | 100 | 100 |

### 初始装备

- **基础火炮**: 动能伤害，15点基础伤害，0.5秒冷却

---

## 敌人配置

### 第一波：初次接触

**延迟**: 2秒后生成

| 敌人类型 | 数量 | 生成间隔 |
|----------|------|----------|
| 机械鱼 | 2 | 1秒 |

**机械鱼属性**:
- 生命值: 60
- 移动速度: 3.5
- 攻击伤害: 12
- 攻击冷却: 1.5秒
- 攻击范围: 2.0米
- 检测范围: 12米
- 防御减伤: 10%

### 第二波：增援到达

**延迟**: 第一波清理后3秒

| 敌人类型 | 数量 | 生成间隔 |
|----------|------|----------|
| 机械鱼 | 1 | 0.5秒 |
| 机械蟹 | 1 | 0.5秒 |

**机械蟹属性**:
- 生命值: 100
- 移动速度: 2.0
- 攻击伤害: 20
- 攻击冷却: 2.0秒
- 攻击范围: 1.5米
- 检测范围: 10米
- 防御减伤: 30%

---

## 掉落配置

### 机械鱼掉落

**必掉物品**:
- 机械鱼残骸 x1-2 (100%)

**随机掉落** (最多1个):
- 金属碎片 x1-3 (50%)
- 能量电池 x1 (30%)

**信用点**: 10-20

### 机械蟹掉落

**必掉物品**:
- 机械蟹壳 x1 (100%)

**随机掉落** (最多1个):
- 装甲板 x1-2 (40%)

**信用点**: 20-35

---

## 测试步骤

### 前置条件

1. 确保所有集成系统脚本已导入
2. 确保敌人预制体已配置
3. 确保玩家机甲预制体已配置
4. 确保战斗反馈系统已配置

### 测试流程

#### 步骤1: 场景加载

1. 打开场景 `CombatTest_50m`
2. 检查场景边界是否正确生成
3. 检查玩家是否正确生成在 (0, 0)
4. 检查集成系统是否正确初始化

**预期结果**:
- 场景边界可见
- 玩家机甲出现在中心位置
- 控制台输出 "测试场景初始化完成"

#### 步骤2: 第一波战斗

1. 等待2秒
2. 观察2只机械鱼生成
3. 使用鼠标瞄准并点击攻击
4. 击杀两只机械鱼
5. 观察掉落物生成

**预期结果**:
- 2只机械鱼在随机位置生成
- 武器可以正常发射
- 弹丸命中敌人造成伤害
- 伤害数字正确显示
- 屏幕震动效果触发
- 敌人死亡后掉落资源
- 掉落物可以被拾取

#### 步骤3: 第二波战斗

1. 等待3秒
2. 观察1只机械鱼和1只机械蟹生成
3. 继续战斗直到所有敌人被击杀

**预期结果**:
- 新敌人在第一波清理后生成
- 机械蟹有更高的防御
- 机械蟹攻击造成更多伤害
- 玩家受到伤害时屏幕震动
- 护盾破碎时有特殊反馈

#### 步骤4: 资源收集

1. 移动到掉落物附近
2. 观察掉落物被磁力吸引
3. 拾取所有掉落物
4. 检查背包内容

**预期结果**:
- 掉落物向玩家移动
- 拾取后背包增加物品
- 信用点正确增加

#### 步骤5: 场景完成

1. 确认所有敌人被击杀
2. 观察场景完成事件

**预期结果**:
- 控制台输出 "场景完成"
- 战斗统计正确显示

---

## 验证清单

### 系统集成

- [ ] MechController 与 CombatStats 连接正常
- [ ] EnemyBase 与 DamageCalculator 连接正常
- [ ] WeaponManager 与敌人受击连接正常
- [ ] CombatFeedback 与相机震动连接正常
- [ ] LootDropSystem 正常工作

### 战斗循环

- [ ] 玩家可以正常移动
- [ ] 玩家可以正常攻击
- [ ] 武器切换正常工作
- [ ] 敌人可以检测玩家
- [ ] 敌人可以追击玩家
- [ ] 敌人可以攻击玩家
- [ ] 伤害计算正确
- [ ] 死亡判定正确

### 视觉效果

- [ ] 伤害数字显示正确
- [ ] 屏幕震动效果正常
- [ ] 命中停顿效果正常
- [ ] 护盾破碎特效正常
- [ ] 击杀反馈正常

### 掉落系统

- [ ] 敌人死亡生成掉落物
- [ ] 掉落物种类正确
- [ ] 掉落物数量正确
- [ ] 掉落物可以被拾取
- [ ] 背包正确更新

---

## 常见问题排查

### 问题1: 敌人不生成

**可能原因**:
- 预制体引用丢失
- CombatSceneManager 未启用
- 生成点配置错误

**解决方案**:
1. 检查 TestSceneSpawner 的预制体引用
2. 确认 CombatSceneManager 在场景中
3. 检查生成点是否正确配置

### 问题2: 伤害不生效

**可能原因**:
- 碰撞层配置错误
- DamageBridge 未添加
- CombatStats 未初始化

**解决方案**:
1. 检查碰撞层设置
2. 确认敌人有 EnemyDamageBridge 组件
3. 检查 CombatStats 初始化

### 问题3: 掉落物不生成

**可能原因**:
- LootDropSystem 未初始化
- 掉落表配置错误
- 预制体为空

**解决方案**:
1. 确认 LootDropSystem 在场景中
2. 检查掉落表配置
3. 检查掉落物预制体

### 问题4: 屏幕不震动

**可能原因**:
- CombatFeedback 未配置相机
- 震动强度设置为0
- 震动被其他效果覆盖

**解决方案**:
1. 在 CombatFeedback 中配置主相机
2. 检查震动强度设置
3. 检查 CombatIntegrationSystem 的 enableCameraShake

---

## 性能指标

| 指标 | 目标值 | 测试方法 |
|------|--------|----------|
| 帧率 | >= 60 FPS | Unity Profiler |
| 内存使用 | < 200 MB | Unity Profiler |
| 加载时间 | < 3 秒 | 手动计时 |
| 敌人AI响应 | < 100ms | 观察测试 |

---

## 扩展测试

### 压力测试

1. 将机械鱼数量增加到10只
2. 观察帧率变化
3. 检查是否有卡顿

### 边界测试

1. 玩家移动到场景边界
2. 检查碰撞检测
3. 检查是否穿墙

### 异常测试

1. 玩家在战斗中退出
2. 重新进入场景
3. 检查状态是否正确重置

---

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| 1.0.0 | 2026-02-27 | 初始版本 |

---

## 附录

### 控制台命令

```csharp
// 生成测试敌人
TestSceneSpawner.Instance.SpawnEnemyOfType(EnemyType.MechFish);

// 清除所有敌人
TestSceneSpawner.Instance.ClearEnemies();

// 重新生成场景
TestSceneSpawner.Instance.RespawnScene();

// 治疗玩家
CombatIntegrationSystem.Instance.HealPlayer(50);

// 杀死所有敌人
foreach(var enemy in FindObjectsOfType<EnemyBase>())
    enemy.SendMessage("Die");
```

### 文件位置

- 集成脚本: `/Assets/Scripts/Integration/`
- 场景配置: `/Assets/Scenes/CombatTest/`
- 测试文档: `/Assets/Scenes/CombatTest/SceneConfig_50m.json`
